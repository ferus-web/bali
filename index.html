
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bali.xtrayambak.xyz/">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>The Bali JavaScript Engine</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bali" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="The Bali JavaScript Engine" class="md-header__button md-logo" aria-label="The Bali JavaScript Engine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Bali JavaScript Engine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bali
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ferus-web/bali" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ferus-web/bali
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="The Bali JavaScript Engine" class="md-nav__button md-logo" aria-label="The Bali JavaScript Engine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    The Bali JavaScript Engine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ferus-web/bali" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ferus-web/bali
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="MANUAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with Bali
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="HEAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bali's Heap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="PULSAR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bali's interpreter
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="CODE_STYLE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Style
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bali's JIT compilers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Bali's JIT compilers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="jit/BASELINE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Baseline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="jit/MADHYASTHAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Midtier/Madhyasthal
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="bali">Bali</h1>
<p>Bali (ˈbɑːli) is a work-in-progress JavaScript lexer, parser and interpreter written in Nim that aims to be as compliant as possible to the ECMAScript specifications. 
Bali is still not in a usable state yet and is probably unstable. It is not meant to be used in production for now.</p>
<p>Bali has a bytecode VM as well as two tiers of x86-64 JIT compilers (baseline and midtier).
It also has a tiering mechanism in place to promote functions from the VM to the Baseline JIT to the Midtier JIT as they get hotter.</p>
<p>Bali is licensed under the BSD-3 license, allowing you to freely embed it in any of your programs.</p>
<h1 id="integrating-bali-into-your-programs">Integrating Bali into your programs</h1>
<p>Bali is still an alpha-quality project, but here's how you can embed Bali into your Nim programs.
With it, you can:
- Use JavaScript as a configuration language for your programs
- Write stuff for the JS ecosystem with Nim
and much, much more. (It becomes more useful as it advances!)</p>
<p>For more information, check out the <code>examples/</code> directory as well as the <a href="https://bali.xtrayambak.xyz">Bali Manual</a>.</p>
<h1 id="usage">Usage</h1>
<ul>
<li>Bali is integrated into the <a href="https://github.com/ferus-web/ferus">Ferus web engine</a> and used as the JavaScript runtime's backend</li>
<li>It is integrated into <a href="https://github.com/xTrayambak/basket">Basket</a>, a fast app launcher for Wayland compositors for configuration. 
Have a cool project that you use Bali in? Open a PR and add it here! :^)</li>
</ul>
<h1 id="how-compliant-is-it">How compliant is it?</h1>
<p>Thanks to <a href="https://github.com/CanadaHonk">@CanadaHonk</a>, Bali is now on <a href="https://test262.fyi/#|bali">test262.fyi</a>! 
You can check how much Bali progresses/regresses by each day's run.</p>
<h1 id="how-well-written-is-it">How "well written" is it?</h1>
<p>Bali is formatted using the <a href="https://github.com/arnetheduck/nph">nph</a> code formatter and each commit is statically analyzed by <a href="https://github.com/thindil/nimalyzer">Nimalyzer</a>.</p>
<p>It isn't indicative of the code quality, but I do put some extent into making the code slightly readable. :^)</p>
<h1 id="how-fast-is-it">How fast is it?</h1>
<p>With some recent codegen optimizations, Bali is already pretty fast on cherry-picked benchmarks. Bali can perform some optimizations when it is generating code for the provided JavaScript source, granted that it can prove that there is an opportunity to optimize away things.</p>
<p>It also has some rudimentary dead code elimination for some cases.</p>
<p><strong>CPU</strong>: AMD Ryzen 5 5600H (12) @ 4.28 GHz 
<strong>RAM</strong>: 16 GB + 32GB swap</p>
<h2 id="iterating-999999999-times-and-incrementing-an-integer-each-loop">Iterating 999999999 times and incrementing an integer each loop</h2>
<p>Bali has some loop elision optimizations in place which can fully eliminate an expensive loop when it sees the opportunity.</p>
<p><strong>NOTE</strong>: The "JIT" benchmark is actually misleading, because here the "hot part" of the code is fully removed during bytecode generation.
The JIT is never triggered since there's nothing to optimize.
As such, both of these benchmarks are actually just running in the interpreter. :^)</p>
<p><strong>Try it for yourself</strong>: <a href="tests/data/iterate-for-no-reason-001.js">Source code</a>
| Engine                  | Time Taken                                                     |
| ----------------------- | -------------------------------------------------------------- |
| Bali (Interpreter)      | 3.9ms (best case) - 5.9ms (worst case)                         |
| Bali (JIT)              | 3.9ms (best case) - 6.0ms (worst case)                         |   </p>
<p>This proves that the JIT barely worsens the worst case scenario.</p>
<h2 id="finding-a-substring-in-a-moderately-large-string">Finding a substring in a moderately large string</h2>
<p>Bali's string-find function (<code>String.prototype.indexOf</code>) is SIMD-accelerated, and as such, is pretty fast.</p>
<p><strong>NOTE</strong>: The "JIT" benchmark is actually misleading, because here the "hot part" of the code is fully removed during bytecode generation.
The JIT is never triggered since there's nothing to optimize.
As such, both of these benchmarks are actually just running in the interpreter. :^)</p>
<p><strong>Try it for yourself</strong>: <a href="tests/data/string-find-001.js">Source code</a>
| Engine                     | Time Taken                                   |
| -------------------------- | -------------------------------------------- |
| Bali (Interpreter)         | 4.1ms (best case) - 6.1ms (worst case)       |
| Bali (JIT)                 | 4.1ms (best case) - 7.1ms (worst case)       |</p>
<h2 id="jit-triggering-microbenchmark">JIT-triggering microbenchmark</h2>
<p>This script is intentionally designed to make Bali's profiling mechanism catch onto it and optimize it.</p>
<p><strong>Try it for yourself</strong>: <a href="tests/data/trigger-jit-001.js">Source code</a>
| Engine                     | Time Taken                                   |
| -------------------------- | -------------------------------------------- |
| Bali (Interpreter)         | 586.9ms (best case) - 601.3ms (worst case)   |
| Bali (JIT)                 | 356.7ms (best case) - 374.5ms (worst case)   |</p>
<p>Here, the JIT is <strong>1.65x</strong> faster than the interpreter!</p>
<h1 id="contact-me">Contact Me</h1>
<p>You can join the <a href="https://discord.gg/9MwfGn2Jkb">Ferus Discord Server</a> to discuss Bali and other components of the Ferus web engine.</p>
<h1 id="specification-compliance">Specification Compliance</h1>
<p>As of 9th of November, 2024, Bali can successfully run 1% of the entire Test262 suite* (I believe that our test runner is currently under-estimating).
There's a lot of work to be done here, so don't shy away from sending in PRs. ;)</p>
<h1 id="running-code-with-bali">Running code with Bali</h1>
<p>You can compile Balde, the Bali debugger by running:</p>
<pre><code>$ nimble build balde
</code></pre>
<p>You can run it with no arguments and it'll start up in a REPL. 
It is primarily used for debugging the engine as of right now, but it runs code fine too.</p>
<h1 id="integrating-bali-into-your-applications">Integrating Bali into your applications</h1>
<p><strong>Bali requires the C++ backend to be used as it depends on simdutf and LibICU!</strong></p>
<p>You need to provide Bali with three dependencies: <strong>simdutf</strong>, <strong>icu</strong> (version 76) and <strong>gmp</strong>. Most of these can be installed via your system's package manager.</p>
<p>Firstly, add Bali to your project's dependencies.</p>
<pre><code>$ nimble add gh:ferus-web/bali
</code></pre>
<p>Here is a basic example of the API:</p>
<pre><code class="language-nim">import pkg/bali/grammar/prelude
import pkg/bali/runtime/prelude

const JS_SRC = &quot;&quot;&quot;
console.log(&quot;Hello world!&quot;)
console.log(13 + 37)

var myUrl = new URL(&quot;https://github.com/ferus-web/bali&quot;)
console.warn(myUrl.origin)

var commitsToBali = 171
while (commitsToBali &lt; 2000) {
    commitsToBali++
    console.log(commitsToBali)
}

for (var x = 0; x &lt; 32; x++) { console.log(&quot;Hello, number&quot;, x) }

try
{
    throw &quot;woe be upon ye&quot;;
} catch (error_thingy)
{
    console.log(error_thingy)
}

const encoded = btoa(&quot;Hello base64&quot;)

let lemonade = fetchLemonade(4)
console.log(lemonade)
&quot;&quot;&quot;

let 
  parser = newParser(JS_SRC) # Feed your JavaScript code to Bali's JavaScript parser
  ast = parser.parse() # Parse an AST out of the tokens
  runtime = newRuntime(&quot;myfile.js&quot;, ast) # Instantiate the JavaScript runtime.

# define a native function which is exposed to the JavaScript code
runtime.defineFn(
    &quot;fetchLemonade&quot;,
    proc =
      let num = runtime.ToNumber(&amp;runtime.argument(1))

      if num == 0 or num &gt; 1:
        ret str(&quot;You have &quot; &amp; $num &amp; &quot; lemonades!&quot;)
      else:
        ret str(&quot;You have a lemonade!&quot;)
)

# Emit Mirage bytecode and pass over control to the Mirage VM.
# NOTE: This is a blocking function and will block this thread until execution is completed (or an error is encountered and the
# interpreter is halted)
runtime.run()
</code></pre>
<h1 id="roadmap">Roadmap</h1>
<ul>
<li>[X] Getting a grammar to AST parser</li>
<li>[X] Getting the MIR emitter working</li>
<li>[X] Get arithmetic operations working</li>
<li>[X] Console API</li>
<li>[X] While loops</li>
<li>[X] Nested object field access</li>
<li>[X] <code>typeof</code></li>
<li>[X] Arrays</li>
<li>[X] REPL</li>
<li>[X] String prototype</li>
<li>[X] Date prototype</li>
<li>[X] Ternary operations</li>
<li>[X] Functions as values</li>
<li>[X] For-loops</li>
<li>[X] Try-catch clauses</li>
<li>[X] Compound assignments</li>
<li>[X] x86-64 JIT compiler (2 tiers)</li>
<li>[ ] Modules</li>
<li>[ ] Async</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2025 Trayambak Rai
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>